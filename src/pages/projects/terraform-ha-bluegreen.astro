---
import Layout from "../../layouts/Layout.astro";
import architectureDiagram from "../../assets/aws-bluegreen-architecture.png";

const title = "Terraform HA Blue/Green Web Tier (SSM-Only)";
const github = "https://github.com/clorenz-git/terraform-ha-bluegreen";
---

<Layout title={title}>
    <main class="container" style="padding:42px 0 80px;">
        <a class="pill" href="/" style="margin-bottom:16px;">&larr; Back</a>

        <section class="card" style="padding:24px;">
            <h1>{title}</h1>
            <p>
                A production-style high availability web tier on AWS built
                entirely with Terraform. This project implements blue/green
                deployments using ALB weighted target groups and Auto Scaling
                Groups running in private subnets, with SSM-only access (no SSH
                keys, no bastion host) and IMDSv2 enforced.
            </p>

            <div
                style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;"
            >
                <span class="pill">AWS</span>
                <span class="pill">Terraform</span>
                <span class="pill">ALB</span>
                <span class="pill">Auto Scaling</span>
                <span class="pill">EC2</span>
                <span class="pill">SSM</span>
                <span class="pill">Amazon Linux 2023</span>
                <span class="pill">IMDSv2</span>
            </div>

            <div
                style="display:flex; gap:12px; flex-wrap:wrap; margin-top:18px;"
            >
                <a
                    class="btn primary"
                    href={github}
                    target="_blank"
                    rel="noreferrer"
                >
                    View code on GitHub
                </a>
            </div>
        </section>

        <section class="card" style="padding:22px; margin-top:16px;">
            <h2>Architecture</h2>

            <img
                src={architectureDiagram}
                alt="Terraform blue/green high availability architecture"
                style="width:100%; border-radius:12px; display:block;"
                loading="lazy"
            />

            <p style="margin-top:12px; color:var(--muted);">
                High availability web tier using an Application Load Balancer
                with weighted target groups, blue/green Auto Scaling Groups in
                private subnets, and SSM-only management access.
            </p>
        </section>

        <section class="card" style="padding:22px; margin-top:16px;">
            <h2>Problem</h2>
            <p>
                I wanted a practical, enterprise-style Terraform project that
                goes beyond “spin up an EC2 instance” and focuses on real
                deployment and resiliency patterns: high availability across
                subnets, secure access without SSH, and a blue/green workflow
                that supports fast, low-risk cutovers.
            </p>
        </section>

        <section class="card" style="padding:22px; margin-top:16px;">
            <h2>Approach</h2>
            <ul style="color:var(--muted); line-height:1.7;">
                <li>
                    Build a VPC layout with public subnets for the load balancer
                    and private subnets for compute.
                </li>
                <li>
                    Deploy an internet-facing Application Load Balancer with two
                    target groups (Blue / Green) and weighted forwarding.
                </li>
                <li>
                    Provision two Auto Scaling Groups (Blue / Green) behind the
                    ALB, each using its own launch template and bootstrap
                    script.
                </li>
                <li>
                    Use Amazon Linux 2023 and a small systemd service to serve a
                    simple page showing the color and instance ID.
                </li>
                <li>
                    Manage instances through AWS Systems Manager Session Manager
                    and disable SSH on the hosts.
                </li>
            </ul>
        </section>

        <section class="card" style="padding:22px; margin-top:16px;">
            <h2>Key Decisions</h2>
            <ul style="color:var(--muted); line-height:1.7;">
                <li>
                    Use ALB weighted target groups for blue/green traffic
                    shifting instead of swapping DNS or rebuilding instances for
                    a cutover.
                </li>
                <li>
                    Keep compute in private subnets and rely on SSM Session
                    Manager for access (no keys, no inbound port 22, no bastion
                    host).
                </li>
                <li>
                    Enforce IMDSv2 to align with modern EC2 hardening
                    expectations.
                </li>
                <li>
                    Avoid NAT Gateway and WAF to keep the project low-cost while
                    still demonstrating secure-by-default patterns.
                </li>
                <li>
                    Enable ASG instance refresh on launch template changes to
                    support an immutable-style workflow.
                </li>
            </ul>
        </section>

        <section class="card" style="padding:22px; margin-top:16px;">
            <h2>Results</h2>
            <ul style="color:var(--muted); line-height:1.7;">
                <li>
                    Fully working HA web tier managed end-to-end with Terraform.
                </li>
                <li>
                    Verified blue/green cutover by shifting ALB target group
                    weights and observing immediate traffic changes.
                </li>
                <li>
                    Verified SSM-only management access and validated SSH was
                    disabled on instances.
                </li>
                <li>
                    Reusable module structure (network, compute, endpoints) that
                    can be extended for failover and monitoring in a v2.
                </li>
            </ul>
        </section>
    </main>
</Layout>
